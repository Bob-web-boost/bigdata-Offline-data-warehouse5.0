# 一、项目需求分析

## 1. 采集平台
  （1）用户行为数据采集平台搭建
  
  （2）业务数据采集平台搭建
## 2. 离线需求

![离线需求]()
## 3. 实时需求
![实时需求]()

# 二、 项目框架

## 1. 技术选型  

 ![技术选型](https://bob-web-boost.oss-cn-hangzhou.aliyuncs.com/images/%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B.png)  
 
## 2. 系统数据流程图
 ![系统数据流程图](https://bob-web-boost.oss-cn-hangzhou.aliyuncs.com/images/系统数据流程图.png)  
 
 注：实时数仓ODS层来自Kafka集群
 
## 3. 框架版本选型
1）如何选择Apache/CDH/HDP版本？  

（1）Apache：运维麻烦，组件间兼容性需要自己调研。（一般大厂使用，技术实力雄厚，有专业的运维人员） （建议使用）  

（2）CDH：国内使用最多的版本，但CM不开源，今年开始收费，一个节点1万美金/年。  

（3）HDP：开源，可以进行二次开发，但是没有CDH稳定，国内使用较少  

2）云服务选择  

（1）阿里云的EMR、MaxCompute、DataWorks  

（2）亚马逊云EMR  

（3）腾讯云EMR  

（4）华为云EMR  

![Apache框架版本选型](https://bob-web-boost.oss-cn-hangzhou.aliyuncs.com/images/Apache框架版本.png)  

注意事项：框架选型尽量不要选择最新的框架，选择最新框架半年前左右的稳定版。  

## 4. 服务器选型  
服务器选择物理机还是云主机？  

1）物理机： 

➢ 以128G内 存，20核物理CPU，40线程，8THDD和2TSSD硬 盘，戴尔品牌单台报价4W出头。一般物理机寿命5年左右。  

➢ 需要有专业的运维人员，平均一个月1万。电费也是不少的开销。  

2）云主机：  

➢ 云主机：以阿里云为例，差不多相同配置，每年5W。  

➢ 很多运维工作都由阿里云完成，运维相对较轻松  

3）企业选择  

➢ 金融有钱公司和阿里没有直接冲突的公司选择阿里云  

➢ 中小公司、为了融资上市，选择阿里云，拉倒融资后买物理机。  

➢ 有长期打算，资金比较足，选择物理机。  

## 5. 集群规模  
 
如何确认集群规模？（假设：每台服务器8T磁盘，128G内存）  

（1）每天日活跃用户100万，每人一天平均100条：100万*100条=1亿条  

（3）半年内不扩容服务器来算：100G*180天=约18T  

（4）保存3副本：18T*3=54T  

（5）预留20%~30%Buf=54T/0.7=77T  

（6）算到这：约8T*10台服务器 

## 6. 集群资源规划设计  
  在企业中通常会搭建一套生产集群和一套测试集群。生产集群运行生产任务，测试集群用于上线前代码编写和测试。  

1）生产集群  

（1）消耗内存的分开  

（2）数据传输数据比较紧密的放在一起（Kafka 、Zookeeper）  

（3）客户端尽量放在一到两台服务器上，方便外部访问  

（4）有依赖关系的尽量放到同一台服务器（例如：Hive 和 mysql）  

